# OxSCADA Acceleration Initiative

> **Goal**: Simultaneously expand learning tracks and accelerate towards a fully functional SCADA system with HMI and PLC development agentics.

## Strategy Overview

```
┌─────────────────────────────────────────────────────────────────┐
│                    ACCELERATION PILLARS                         │
├─────────────────┬─────────────────┬─────────────────┬───────────┤
│  Vertical Slice │  HMI/PLC Agents │ Protocol Sims   │ Capstones │
│  (Proof of Life)│  (Force Mult.)  │ (Unblock All)   │ (Learn)   │
└────────┬────────┴────────┬────────┴────────┬────────┴─────┬─────┘
         │                 │                 │              │
         └─────────────────┴─────────────────┴──────────────┘
                          Parallel Execution
```

---

## Pillar 1: Vertical Slice (Proof of Life)

### Objective
Build one complete data flow from physical tag to blockchain anchor, proving all layers can integrate.

### The Slice: Tank Level Monitor

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  Simulated  │     │   Gateway   │     │   Server    │
│  Modbus     │────▶│   Service   │────▶│   API       │
│  Device     │     │             │     │             │
└─────────────┘     └─────────────┘     └──────┬──────┘
     TK-101              TCP/502               │
   Level: 75%                                  │
                                               ▼
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│  Blockchain │◀────│   Event     │◀────│   React     │
│  Anchor     │     │   Service   │     │   HMI       │
└─────────────┘     └─────────────┘     └─────────────┘
   0x5CADA            Threshold            Tank Widget
                      Alerts
```

### Implementation Tasks

| Task | Track | Issue | Priority |
|------|-------|-------|----------|
| Modbus TCP simulator | B | VS-1.1 | P0 |
| Gateway Modbus driver | B | VS-1.2 | P0 |
| Tag subscription API | B | VS-1.3 | P0 |
| Tank level HMI widget | A | VS-1.4 | P0 |
| High-level alarm event | B | VS-1.5 | P1 |
| Event blockchain anchor | C | VS-1.6 | P1 |
| End-to-end integration test | Q | VS-1.7 | P1 |

### Success Criteria
- [ ] Simulated tank level readable via API
- [ ] HMI displays live value with < 1s latency
- [ ] Threshold crossing generates alarm event
- [ ] Event hash anchored to 0x5CADA chain

---

## Pillar 2: HMI/PLC Development Agentics

### New Agent Specifications

#### `qe-hmi-generator`

**Purpose**: Generate React HMI components from P&ID diagrams or specifications.

```typescript
// Agent Specification
interface HMIGeneratorAgent {
  type: "qe-hmi-generator";
  capabilities: [
    "svg-parsing",           // Parse P&ID SVG symbols
    "react-codegen",         // Generate React components
    "data-binding",          // Wire to tag subscriptions
    "alarm-integration",     // Connect alarm indicators
    "isa-5.1-symbols"        // ISA 5.1 symbol library
  ];

  inputs: {
    pidDiagram?: string;     // SVG file path
    tagList?: Tag[];         // Tags to display
    screenType: "overview" | "detail" | "faceplate";
  };

  outputs: {
    components: ReactComponent[];
    storybook: StorybookStory[];
    tests: TestFile[];
  };
}
```

**Generation Flow**:
```
P&ID SVG ──▶ Symbol Detection ──▶ Tag Mapping ──▶ Component Tree ──▶ React Code
                  │                    │                │
                  ▼                    ▼                ▼
            ISA-5.1 DB          Tag Database      shadcn/ui base
```

#### `qe-plc-codegen`

**Purpose**: Generate IEC 61131-3 PLC code from control module specifications.

```typescript
interface PLCCodegenAgent {
  type: "qe-plc-codegen";
  capabilities: [
    "structured-text",       // IEC 61131-3 ST output
    "ladder-logic",          // LD output (visual)
    "function-blocks",       // FBD output
    "multi-vendor",          // Siemens, Allen-Bradley, Schneider
    "isa-88-phases"          // Batch phase generation
  ];

  inputs: {
    controlModule: ControlModuleSpec;
    targetPlatform: "siemens-s7" | "ab-logix" | "schneider-m340" | "codesys";
    safetyLevel?: "SIL1" | "SIL2" | "SIL3";
  };

  outputs: {
    code: PLCCode;
    documentation: string;
    testVectors: TestVector[];
  };
}

interface ControlModuleSpec {
  name: string;
  type: "valve" | "motor" | "pid-loop" | "sequence";
  inputs: IOPoint[];
  outputs: IOPoint[];
  states: StateMachine;
  interlocks: Interlock[];
}
```

**Example Output** (Valve Control Module):
```iecst
// Auto-generated by qe-plc-codegen
// Control Module: XV-101 (Block Valve)
// Target: CODESYS / IEC 61131-3 ST

FUNCTION_BLOCK FB_Valve_XV101
VAR_INPUT
    CMD_Open    : BOOL;     // Command to open
    CMD_Close   : BOOL;     // Command to close
    IL_OK       : BOOL;     // Interlock permissive
VAR_OUTPUT
    DO_Solenoid : BOOL;     // Output to solenoid
    ZSO         : BOOL;     // Open limit switch
    ZSC         : BOOL;     // Closed limit switch
    State       : INT;      // 0=Closed, 1=Opening, 2=Open, 3=Closing, 4=Fault
VAR
    TON_Travel  : TON;      // Travel timeout
END_VAR

// State machine implementation
CASE State OF
    0: // CLOSED
        DO_Solenoid := FALSE;
        IF CMD_Open AND IL_OK THEN
            State := 1;
            TON_Travel(IN := TRUE, PT := T#10S);
        END_IF;

    1: // OPENING
        DO_Solenoid := TRUE;
        TON_Travel(IN := TRUE);
        IF ZSO THEN
            State := 2;
            TON_Travel(IN := FALSE);
        ELSIF TON_Travel.Q THEN
            State := 4; // Fault - travel timeout
        END_IF;

    // ... continued
END_CASE
END_FUNCTION_BLOCK
```

#### `qe-protocol-validator`

**Purpose**: Validate protocol implementations against specifications.

```typescript
interface ProtocolValidatorAgent {
  type: "qe-protocol-validator";
  capabilities: [
    "modbus-compliance",     // Modbus TCP/RTU spec compliance
    "opcua-compliance",      // OPC-UA CTT equivalent
    "dnp3-compliance",       // DNP3 SAv5 compliance
    "iec104-compliance",     // IEC 60870-5-104
    "fuzzing"                // Protocol fuzzing for robustness
  ];

  inputs: {
    target: string;          // Host:port or device path
    protocol: "modbus-tcp" | "opcua" | "dnp3" | "iec104";
    testSuite: "conformance" | "interop" | "security" | "fuzz";
  };

  outputs: {
    report: ComplianceReport;
    failures: ProtocolViolation[];
    recommendations: string[];
  };
}
```

#### `qe-isa88-validator`

**Purpose**: Validate batch sequences against ISA-88 state model.

```typescript
interface ISA88ValidatorAgent {
  type: "qe-isa88-validator";
  capabilities: [
    "state-model-check",     // Verify S88 state transitions
    "recipe-validation",     // Validate recipe structure
    "equipment-mapping",     // Check equipment module assignments
    "sequence-simulation"    // Dry-run sequence execution
  ];

  inputs: {
    recipe: Recipe;
    equipmentModel: EquipmentHierarchy;
    mode: "validate" | "simulate";
  };

  outputs: {
    valid: boolean;
    stateTrace: StateTransition[];
    violations: S88Violation[];
    timeline: SimulatedTimeline;
  };
}
```

---

## Pillar 3: Protocol Simulators

### Virtual Plant Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                      Virtual Plant Environment                   │
│  ┌───────────────────────────────────────────────────────────┐  │
│  │                    Process Simulation                      │  │
│  │  ┌─────────┐    ┌─────────┐    ┌─────────┐               │  │
│  │  │  Tank   │───▶│  Pump   │───▶│  Valve  │               │  │
│  │  │  TK-101 │    │  P-101  │    │  XV-101 │               │  │
│  │  └────┬────┘    └────┬────┘    └────┬────┘               │  │
│  │       │              │              │                     │  │
│  │       ▼              ▼              ▼                     │  │
│  │  ┌─────────────────────────────────────────────────────┐ │  │
│  │  │              Soft PLC Runtime (CODESYS)              │ │  │
│  │  └─────────────────────────────────────────────────────┘ │  │
│  └───────────────────────────────────────────────────────────┘  │
│                              │                                   │
│  ┌───────────────────────────┴───────────────────────────────┐  │
│  │                   Protocol Adapters                        │  │
│  │  ┌─────────┐  ┌─────────┐  ┌─────────┐  ┌─────────┐      │  │
│  │  │ Modbus  │  │ OPC-UA  │  │  DNP3   │  │ IEC-104 │      │  │
│  │  │  :502   │  │  :4840  │  │ :20000  │  │  :2404  │      │  │
│  │  └─────────┘  └─────────┘  └─────────┘  └─────────┘      │  │
│  └───────────────────────────────────────────────────────────┘  │
└─────────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ┌─────────────────┐
                    │ OxSCADA Gateway │
                    │    Service      │
                    └─────────────────┘
```

### Simulator Components

#### 1. Modbus TCP Simulator (`@oxscada/modbus-sim`)

```typescript
// packages/modbus-sim/src/server.ts
interface ModbusSimulator {
  // Register banks
  coils: boolean[];           // 0xxxx - Discrete outputs
  discreteInputs: boolean[];  // 1xxxx - Discrete inputs
  holdingRegisters: number[]; // 4xxxx - Read/write registers
  inputRegisters: number[];   // 3xxxx - Read-only registers

  // Simulation hooks
  onRead(address: number, quantity: number): void;
  onWrite(address: number, values: number[]): void;

  // Process model binding
  bindTag(tag: string, registerType: string, address: number): void;
}

// Example: Tank level bound to holding register 40001
simulator.bindTag("TK-101.Level", "holdingRegister", 1);
simulator.holdingRegisters[1] = 750; // 75.0%
```

#### 2. OPC-UA Simulator (`@oxscada/opcua-sim`)

```typescript
interface OPCUASimulator {
  // Node management
  addVariable(nodeId: string, dataType: string, value: any): void;
  addObject(nodeId: string, browseName: string): void;

  // Subscription support
  onSubscribe(nodeId: string, callback: (value: any) => void): void;

  // Alarm & Events
  raiseEvent(eventType: string, message: string, severity: number): void;
}
```

#### 3. Process Model (`@oxscada/process-sim`)

Simple physics for realistic simulation:

```typescript
interface Tank {
  volume: number;        // Current volume (L)
  capacity: number;      // Max capacity (L)
  inflow: number;        // Current inflow (L/s)
  outflow: number;       // Current outflow (L/s)

  // Computed
  level(): number;       // Percentage
  update(dt: number): void;
}

interface Pump {
  running: boolean;
  speed: number;         // 0-100%
  flowRate(): number;    // L/s based on speed and curve
}

interface Valve {
  position: number;      // 0-100%
  cv: number;            // Flow coefficient
  flowRate(dp: number): number;
}
```

### Docker Compose Setup

```yaml
# docker-compose.simulator.yml
version: '3.8'

services:
  process-sim:
    build: ./packages/process-sim
    environment:
      - TICK_RATE=100ms
    volumes:
      - ./config/plant-model.json:/app/config/plant.json

  modbus-sim:
    build: ./packages/modbus-sim
    ports:
      - "502:502"
    depends_on:
      - process-sim
    environment:
      - PROCESS_SIM_URL=http://process-sim:3000

  opcua-sim:
    build: ./packages/opcua-sim
    ports:
      - "4840:4840"
    depends_on:
      - process-sim

  gateway:
    build: ./server
    ports:
      - "3001:3001"
    environment:
      - MODBUS_HOST=modbus-sim
      - OPCUA_HOST=opcua-sim
```

---

## Pillar 4: Cross-Track Capstone Projects

### Capstone 1: Tank Farm Monitor (Tracks A + B + E)

**Objective**: Complete HMI for monitoring 3 tanks with level, temperature, and alarms.

```
┌────────────────────────────────────────────────────────┐
│  TANK FARM OVERVIEW                          [ALARMS] │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐            │
│  │  TK-101  │  │  TK-102  │  │  TK-103  │            │
│  │  ┌────┐  │  │  ┌────┐  │  │  ┌────┐  │            │
│  │  │████│  │  │  │██  │  │  │  │████│  │            │
│  │  │████│  │  │  │██  │  │  │  │████│  │            │
│  │  │████│  │  │  │    │  │  │  │████│  │            │
│  │  └────┘  │  │  └────┘  │  │  └────┘  │            │
│  │  75.2%   │  │  23.1%   │  │  98.4%   │            │
│  │  45.2°C  │  │  38.7°C  │  │  52.1°C  │  ⚠️ HIGH  │
│  └──────────┘  └──────────┘  └──────────┘            │
└────────────────────────────────────────────────────────┘
```

**Learning Outcomes**:
- Track A: React components, real-time data binding, alarm indicators
- Track B: Multi-device polling, data aggregation, WebSocket push
- Track E: P&ID symbology, alarm setpoints, process understanding

**Issues**: CAP-1.1 through CAP-1.12

---

### Capstone 2: Batch Recipe Editor (Tracks A + E + C)

**Objective**: Visual editor for ISA-88 batch recipes with blockchain audit trail.

**Learning Outcomes**:
- Track A: Drag-drop UI, state visualization, recipe tree
- Track E: ISA-88 model, phase logic, equipment binding
- Track C: Recipe versioning, change audit, hash anchoring

**Issues**: CAP-2.1 through CAP-2.15

---

### Capstone 3: PLC Code Generator (Tracks E + B + Q)

**Objective**: Define control module → generate multi-vendor PLC code → test.

**Learning Outcomes**:
- Track E: IEC 61131-3, state machines, interlock design
- Track B: Code generation, template engines, AST manipulation
- Track Q: Generated code testing, mutation testing, coverage

**Issues**: CAP-3.1 through CAP-3.10

---

### Capstone 4: Protocol Compliance Suite (Tracks D + Q + B)

**Objective**: Kernel packet inspection + QE fuzzing for protocol validation.

**Learning Outcomes**:
- Track D: Netfilter hooks, packet parsing, kernel debugging
- Track Q: Fuzz testing, property-based testing, chaos engineering
- Track B: Protocol state machines, connection management

**Issues**: CAP-4.1 through CAP-4.12

---

## Implementation Sequence

### Phase 0: Foundation (Parallel Start)

```
Week 1-2:
├── [B] Modbus TCP simulator skeleton
├── [A] Tank widget component
├── [E] Control module spec format
└── [Q] Protocol test harness
```

### Phase 1: Vertical Slice Complete

```
Week 3-4:
├── [B] Gateway Modbus driver
├── [A] HMI tag subscription hook
├── [C] Event anchoring service
└── [Q] End-to-end test suite
```

### Phase 2: Agent Development

```
Week 5-8:
├── qe-hmi-generator v0.1
├── qe-plc-codegen v0.1
├── qe-protocol-validator v0.1
└── qe-isa88-validator v0.1
```

### Phase 3: Capstone Execution

```
Week 9+:
├── Capstone 1: Tank Farm (parallel A+B+E)
├── Capstone 2: Recipe Editor (parallel A+E+C)
├── Capstone 3: PLC Generator (parallel E+B+Q)
└── Capstone 4: Protocol Suite (parallel D+Q+B)
```

---

## GitHub Issue Templates

### Vertical Slice Issue

```markdown
---
name: Vertical Slice Task
about: Task for the proof-of-life vertical slice
labels: ["vertical-slice", "priority:p0"]
---

## Task
[Description]

## Track
- [ ] A - Frontend
- [ ] B - Backend
- [ ] C - Blockchain
- [ ] E - Automation
- [ ] Q - Quality

## Acceptance Criteria
- [ ] Criterion 1
- [ ] Criterion 2

## Dependencies
- Blocked by: #
- Blocks: #

## Vertical Slice Context
This task is part of the Tank Level Monitor vertical slice (VS-1.x).
See: docs/ACCELERATION.md#pillar-1-vertical-slice
```

### Capstone Issue

```markdown
---
name: Capstone Project Task
about: Task for cross-track capstone projects
labels: ["capstone"]
---

## Capstone
- [ ] CAP-1: Tank Farm Monitor
- [ ] CAP-2: Batch Recipe Editor
- [ ] CAP-3: PLC Code Generator
- [ ] CAP-4: Protocol Compliance Suite

## Task
[Description]

## Tracks Involved
[List tracks and what each contributes]

## Learning Outcomes
- Skill 1
- Skill 2

## Acceptance Criteria
- [ ] Criterion 1
- [ ] Criterion 2
```

---

## Success Metrics

| Metric | Target | Measurement |
|--------|--------|-------------|
| Vertical Slice Complete | 4 weeks | Tag-to-chain data flow working |
| Simulator Coverage | 90% | Protocol commands implemented |
| Agent Accuracy | 80% | Generated code compiles/works |
| Capstone Completion | 2/track/quarter | Contributors finishing projects |
| Cross-Track PRs | 30% | PRs touching multiple tracks |

---

## Quick Start for Contributors

### Join the Acceleration

1. **Pick a pillar** that matches your interests
2. **Filter issues** by `vertical-slice`, `agent-dev`, `simulator`, or `capstone`
3. **Check dependencies** - some tasks unblock many others
4. **Claim and go** - mark issue as in-progress and start

### High-Impact First Issues

| Issue | Impact | Tracks |
|-------|--------|--------|
| VS-1.1: Modbus Simulator | Unblocks all protocol work | B |
| VS-1.4: Tank Widget | Unblocks all HMI work | A |
| CAP-1.1: Tank Farm scaffold | First capstone kickoff | A+B |

---

*This acceleration initiative runs parallel to the main roadmap phases.*

**Created**: January 2026
**Status**: Active
